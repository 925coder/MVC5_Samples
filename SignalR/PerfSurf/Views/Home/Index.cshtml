@{
    ViewBag.Title = "Home Page";
}

<h1>Watch Some Counters</h1>

<div class="row">
    <div class="col-md-4">
        <label>
            Your message:
            <input type="text" data-bind="value:message" />
        </label>
        <button class="btn btn-primary" data-bind="click: sendMessage">Send</button>

        <div data-bind="foreach: messages">
            <div data-bind="text: $data"></div>
        </div>
    </div>
</div>

@section scripts{

    <script src="~/Scripts/knockout-2.3.0.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.0.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>

        var perfHub = $.connection.perfHub;
        perfHub.client.newMessage = function (message) {
            model.messages.push(message);
        };


        var Model = function () {
            var self = this;
            self.message = ko.observable(""),
            self.messages = ko.observableArray(),
            self.performanceCounters = ko.observableArray(),
            self.selectedCounter = ko.observable(),
            self.watchedCounters = ko.observableArray()
        };

        Model.prototype = {

            sendMessage: function () {
                var self = this;
                perfHub.server.send(self.message());
                self.message("");
            },

            watchCounter: function () {
                var self = this;
                self.watchedCounters.push(self.selectedCounter());
            },

            getCounters: function () {
                var self = this;

            },

            addCounters: function (counters) {
                var self = this;
                $.each(counters, function (index, value) {
                    self.performanceCounters.push(value);
                });
            }
        };

        var model = new Model();



        var init = function () {
            ko.applyBindings(model);
            $.connection.hub.start().done(function () {
                model.getCounters();
            });
            model.getCounters();
        };

        $(init);
    </script>

}